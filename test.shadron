#include <math_constants>
#include <multisample>
#include <affine_transform>
#include <debug>
#include <dither>
#include <blending>
#include <shapes>

image Spritesheet = file("master_ui.png") :filter(nearest), map(clamp);

const vec2 ZERO2 = vec2(0, 0);
const vec3 ZERO3 = vec3(0, 0, 0);
const vec4 ZERO4 = vec4(0, 0, 0, 0);

const vec2 ONE2 = vec2(1, 1);
const vec3 ONE3 = vec3(1, 1, 1);
const vec4 ONE4 = vec4(1, 1, 1, 1);

const vec4 WHITE = vec4( 1, 1, 1, 1);
const vec4 BLACK = vec4( 0, 0, 0, 1);
const vec4 BLUE = vec4( 0, 0, 1, 1);

const vec4 NULL = vec4(123.456,123.456,123.456,123.456);


const int sides = 24 * 16;
const ivec2 IMG_SIZE = ivec2(16, 16);
const ivec2 SIZE = vec2(1024, 1024);
const int width = SIZE.x;
const int height = SIZE.y;

glsl vec2 SHEET_SIZE = vec2(1024.0f, 1024.0f);

//// gravestone
glsl vec2 SPRITE_ORIGIN = vec2(274.0f,307.0f);
glsl vec2 SPRITE_SIZE = vec2(89.0f, 93.0f);

//// forest
// glsl vec2 SPRITE_ORIGIN = vec2(758.0f, 409.0f);
// glsl vec2 SPRITE_SIZE = vec2(80.0f, 100.0f);


glsl vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
    vec4 color = vec4(0.0);
    vec2 off1 = vec2(1.3333333333333333) * direction;
    color += texture2D(image, uv) * 0.29411764705882354;
    color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;
    color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;
    return color;
}


glsl bool should_print_at_offset(vec2 position, float val, ivec2 offset) {
    ivec2 test_pos = ivec2(shadron_Dimensions*position);
    return printValue(val, test_pos/2 - offset);
};

glsl vec2 my_norm(vec2 val, vec2 min, vec2 max) {
    return (val - min) / (max - min);
};

glsl vec2 my_denorm(vec2 normed, vec2 min, vec2 max) {
    return normed * (max - min) + min;
};


glsl vec4 draw_spritesheet(vec2 position) {
    // return texture(Spritesheet, position);

    vec2 adjusted = position;
    adjusted = my_denorm(adjusted, ZERO2, SHEET_SIZE);
    vec2 in_rect = vec2(adjusted.x, SHEET_SIZE.y -adjusted.y);
    if (rectangle(in_rect, SPRITE_ORIGIN, SPRITE_ORIGIN+SPRITE_SIZE) == 1) {
        vec4 base_tex = texture(Spritesheet, position);
        return base_tex;
    } else  {
        return BLUE;
    };

    vec4 base_tex = texture(Spritesheet, adjusted);
    return base_tex;
};

// The generated cubemap
image GravestoneInSheet = glsl(draw_spritesheet, SIZE);
